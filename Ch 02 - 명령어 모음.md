
```
2장
2장 실습은 컨테이너 런타임이 도커여야 한다. Rancher Desktop이라면 Container Engine을 dockered로 설정한 상태에서 실습을 진행한다. 따로 언급하지 않으면 기본 설정은 containerd이다.


# 컨테이너 하나를 담은 파드를 실행한다
kubectl run hello-kiamol --image=kiamol/ch02-hello-kiamol 

# 파드가 준비 상태가 될 때까지 기다린다
kubectl wait --for=condition=Ready pod hello-kiamol

# 클러스터에 있는 모든 파드의 목록을 출력
kubectl get pods

# 파드의 상세 정보를 확인한다
kubectl describe pod hello-kiamol
-----------------------------------------------------

# 파드에 대한 기본적인 정보를 확인한다
kubectl get pod hello-kiamol

# 네트워크 상세 정보 중 특정한 항목을 따로 지정해 출력한다
kubectl get pod hello-kiamol --output custom-columns=NAME:metadata.name,NODE_IP:status.hostIP,POD_IP:status.podIP

# JSONPath로 복잡한 출력을 구성한다
# 파드의 첫 번째 컨테이너의 컨테이너 식별자만 출력한다
kubectl get pod hello-kiamol -o jsonpath='{.status.containerStatuses[0].containerID}'
-----------------------------------------------------

# 파드에 포함된 컨테이너 찾기
docker container ls -q --filter label=io.kubernetes.container.name=hello-kiamol

# 해당 컨테이너 삭제하기
docker container rm -f $(docker container ls -q --filter label=io.kubernetes.container.name=hello-kiamol)

# 파드 상태 확인
kubectl get pod hello-kiamol

# 이전 컨테이너 다시 찾아보기
docker container ls -q --filter label=io.kubernetes.container.name=hello-kiamol
-----------------------------------------------------

# 로컬 컴퓨터의 8080 포트를 주시하다가 이 포트로 들어오는
# 트래픽을 파드의 80번 포트로 전달한다
kubectl port-forward pod/hello-kiamol 8080:80

# 이제 웹 브라우저에서 http://localhost:8080에 접근한다

# 확인이 끝나면 ctrl+c를 눌러 포트포워딩을 중단한다
-----------------------------------------------------

# 조금 전과 같은 웹 애플리케이션을 실행하는 디플로이먼트
# ‘hello-kiamol-2’를 생성
kubectl create deployment hello-kiamol-2 --image=kiamol/ch02-hello-kiamol

# 파드의 목록을 출력
kubectl get pods
-----------------------------------------------------

# 디플로이먼트가 부여한 파드의 레이블 출력
kubectl get deploy hello-kiamol-2 -o jsonpath='{.spec.template.metadata.labels}'

# 앞서 출력한 레이블을 가진 파드의 목록 출력
kubectl get pods -l app=hello-kiamol-2
-----------------------------------------------------

# 모든 파드의 이름과 레이블 확인
kubectl get pods -o custom-columns=NAME:metadata.name,LABELS:metadata.labels

# 디플로이먼트가 생성한 파드의 ‘app’ 레이블 수정
kubectl label pods -l app=hello-kiamol-2 --overwrite app=hello-kiamol-x

# 파드가 또 하나 생성됐다
kubectl get pods -o custom-columns=NAME:metadata.name,LABELS:metadata.labels
-----------------------------------------------------

# ‘app’이라는 레이블이 부여된 모든 파드의 이름과 레이블 출력
kubectl get pods -l app -o custom-columns=NAME:metadata.name,LABELS:metadata.labels

# 디플로이먼트의 관리를 벗어난 파드의 ‘app’ 레이블을 원래대로 수정
kubectl label pods -l app=hello-kiamol-x --overwrite app=hello-kiamol-2

# 파드의 목록을 다시 한 번 확인
kubectl get pods -l app -o custom-columns=NAME:metadata.name,LABELS:metadata.labels
-----------------------------------------------------

# 로컬 컴퓨터에서 디플로이먼트로 포트 포워딩 설정
kubectl port-forward deploy/hello-kiamol-2 8080:80

# 웹 브라우저에서 http://localhost:8080에 접근한다
# 확인이 끝나면 ctrl+c를 눌러 종료한다
-----------------------------------------------------

# 예제 코드의 최상위 디렉터리에서 ch02 디렉터리로 이동
cd ch02

# 매니페스트 파일로 애플리케이션 배포
kubectl apply -f pod.yaml

# 실행 중인 파드 목록 확인
kubectl get pods
-----------------------------------------------------

# 원격 URL에서 제공되는 매니페스트 파일로 애플리케이션을 배포하라
kubectl apply -f https://raw.githubusercontent.com/sixeyed/kiamol/master/ch02/pod.yaml
-----------------------------------------------------

# 디플로이먼트의 매니페스트로 애플리케이션 실행
kubectl apply -f deployment.yaml

# 새로운 디플로이먼트가 만든 파드 찾기
kubectl get pods -l app=hello-kiamol-4
-----------------------------------------------------

# 처음 실행한 파드의 내부 IP 주소 확인
kubectl get pod hello-kiamol -o custom-columns=NAME:metadata.name,POD_IP:status.podIP

# 파드 내부와 연결할 대화형 셸 실행
kubectl exec -it hello-kiamol sh

# 파드 안에서 IP 주소를 확인하고
hostname -i

# 웹 애플리케이션의 동작 확인
wget -O - http://localhost | head -n 4

# 셸 세션 종료
exit
-----------------------------------------------------

# 쿠버네티스를 통해 컨테이너의 최근 로그를 출력
kubectl logs --tail=2 hello-kiamol

# 그리고 도커를 통해 컨테이너에 접속해 실제 로그와 동일한지 확인
docker container logs --tail=2 $(docker container ls -q --filter label=io.kubernetes.container.name=hello-kiamol)
-----------------------------------------------------

# YAML 파일의 정의에 따라 생성한 디플로이먼트가 만든
# 파드 안에 들어 있는 컨테이너에서 웹 애플리케이션 호출
kubectl exec deploy/hello-kiamol-4 -- sh -c 'wget -O - http://localhost > /dev/null'

# 해당 파드의 로그 열람
kubectl logs --tail=1 -l app=hello-kiamol-4
-----------------------------------------------------

# 로컬 컴퓨터에 임시 디렉터리 생성
mkdir -p /tmp/kiamol/ch02

# 파드 속에서 웹 페이지를 로컬 컴퓨터로 복사
kubectl cp hello-kiamol:/usr/share/nginx/html/index.html /tmp/kiamol/ch02/index.html

# 로컬 컴퓨터에서 파일 내용 확인
cat /tmp/kiamol/ch02/index.html
-----------------------------------------------------

# 실행 중인 모든 파드의 목록 출력
kubectl get pods

# 모든 파드 삭제
kubectl delete pods --all

# 모든 파드가 삭제되었는지 확인
kubectl get pods
-----------------------------------------------------

# 디플로이먼트 목록 확인
kubectl get deploy

# 디플로이먼트 모두 삭제
kubectl delete deploy --all

# 파드 목록 확인
kubectl get pods

# 모든 리소스 목록 확인
kubectl get all
-----------------------------------------------------
```